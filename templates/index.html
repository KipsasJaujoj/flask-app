<!DOCTYPE html>
<html>
    <head>
        <title>Smart recycling bins data</title>
    </head>
    <body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.css" />
	<div><p>config -> {{config }}</p></div>
	<div>Chartjs grafikas:</div>
	<div style="width:900px; height:500px;"><canvas id="chartjs-chart" style="width:900px; height:500px;"></canvas></div>
	<div>dygraphs grafikas:</div>
	<div id="dychart-chart" style="width:900px; height:500px;"></div>
	<p><b>Rodyti:</b></p>
    <div>
      <input type="checkbox" id="0" checked="" onclick="change(this)">
      <label for="0">ec:fa:bc:e:a6:95_1</label>
      <input type="checkbox" id="1" checked="" onclick="change(this)">
      <label for="1">ec:fa:bc:e:a6:95_2</label>
      <input type="checkbox" id="2" checked="" onclick="change(this)">
      <label for="2">ec:fa:bc:e:a6:95_3</label>
	  <input type="checkbox" id="3" checked="" onclick="change(this)">
      <label for="3">ec:fa:bc:e:a6:95_4</label>
    </div>
	<div>
	<form method="post" id="form">
<!--    <button name="time_scale" id="b0" type="submit">Month</button>-->
	<input type="text" id="value" name="time_scale" autofocus autocomplete="off">
	<button>Post</button>
    </form>
	<p id="result"></p>
	</div>


	<script>
	{% set counter = 0 %}
	g = new Chart(document.getElementById("chartjs-chart"), {
  type: 'line',
  data: {
    labels: [ {% for i in distance_data %}new Date("{{ i }}").toLocaleString(){{ ", " if not loop.last }}{% endfor %}],
    datasets: [ {% for i in config['floors'][4] %}{ 
        data: [
		{% for j in distance_data %}{
          t: new Date("{{ j }}"),
          y: {{ distance_data[j][i]['distance'] }}
        }{{ "," if not loop.last }}{% endfor %}
		],
        label: "{{ i }}",
        borderColor: "{{ config['colors'][counter] }}",
        fill: false
      }{{ ", " if not loop.last }}{% set counter = counter + 1 %}{% endfor %}
    ]
  },
  options: {
    title: {
      display: true,
      text: 'Distance data from smart recycling bins'
    }
  }
});</script>
	<script>
    g = new Dygraph(
    document.getElementById("dychart-chart"),
    [{% for i in distance_data %}
	    [new Date("{{ i }}"),{% for j in config['floors'][4] %}{{ distance_data[i][j]['distance'] }}{{ "," if not loop.last }}{% endfor %}]{{ "," if not loop.last }}{% endfor %}
    ],
	{
		labels: ["data", {% for i in config['floors'][4] %}"{{ i }}"{{ ", " if not loop.last }}{% endfor %}],
		rollPeriod: 1,
		showRoller: true,
		legend: 'always',
		axisLabelWidth: 30,
		fillGraph: false,
		ylabel: 'Distance (cm)',
		xlabel: 'Time',
		digitsAfterDecimal: 2,
		showRangeSelector: true,
		rangeSelectorHeight: 30,
		visibility:[true,true,true,true]
	}
);
    setStatus();
    function setStatus() {
      document.getElementById("visibility").innerHTML = g.visibility().toString();
    }
 
    function change(el) {
      g.setVisibility(parseInt(el.id), el.checked);
      setStatus();
    }
	function set_period(period) {
	  return true
	}
	</script>
	<script>
	$('#form').on('submit', function(e){
		var value = $('#value').val();
		e.preventDefault();
		$.ajax({
			url: 'http://127.0.0.1:8080/date/',
			data: {'time_scale': value},
			method: 'POST',
			success: function(data) {
				$('#value').val('');
				$('#result').html('Behold: ' + data['time_scale'])
			}
		});
	});
	</script>
    </body>
</html>
